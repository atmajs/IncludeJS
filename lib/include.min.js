function __eval(e,t){"use strict";return t&&t.route.params,eval.call(window,e)}(function(e,t){"use strict";var n,r,o;"undefined"==typeof exports||e!==exports&&null!=e||(n=global),null==n&&(n="undefined"==typeof window?global:window),o=n.document,r=e||n,t(n,r,o)})(this,function(global,exports,document){"use strict";function fn_proxy(e,t){return function(){e.apply(t,arguments)}}function fn_doNothing(e){"function"==typeof e&&e()}function obj_inherit(e){"function"==typeof e&&(e=e.prototype);for(var t,n,r=1,o=arguments.length;o>r;r++){t="function"==typeof arguments[r]?arguments[r].prototype:arguments[r];for(n in t)e[n]=t[n]}return e}function arr_invoke(e,t,n){if(null!=e&&e instanceof Array!=!1)for(var r=0,o=e.length;o>r;r++)"function"==typeof e[r]&&(null==t?e[r].call(n):e[r].apply(n,t))}function arr_ensure(e,t){if(!t)return e;for(var n,r=t.split("."),o=r.length-1,s=0;o>s;s++)n=r[s],e=e[n]||(e[n]={});return n=r[o],e[n]||(e[n]=[])}function path_getDir(e){var t=e.lastIndexOf("/");return-1===t?"":e.substring(t+1,-t)}function path_resolveCurrent(){if(null==document)return"";var e=document.getElementsByTagName("script"),t=e[e.length-1];return t&&t.getAttribute("src")||""}function path_resolveUrl(e,t){switch(cfg.path&&"/"===e[0]&&(e=cfg.path+e.substring(1)),e.substring(0,5)){case"file:":case"http:":return e}for("./"===e.substring(0,2)&&(e=e.substring(2)),"/"===e[0]?(isWeb===!1||cfg.lockedToFolder===!0)&&(e=e.substring(1)):null!=t&&null!=t.location&&(e=t.location+e);-1!==e.indexOf("../");)e=e.replace(reg_subFolder,"");return e}var bin={},isWeb=!!(global.location&&global.location.protocol&&/^https?:/.test(global.location.protocol)),reg_subFolder=/([^\/]+\/)?\.\.\//,cfg={path:null,loader:null,version:null,lockedToFolder:null,sync:null,eval:null==document},handler={},hasOwnProp={}.hasOwnProperty,__array_slice=Array.prototype.slice,XMLHttpRequest=global.XMLHttpRequest,Helper={reportError:function(e){console.error("IncludeJS Error:",e,e.message,e.url),"function"==typeof handler.onerror&&handler.onerror(e)}},XHR=function(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){4===n.readyState&&t&&t(e,n.responseText)},n.open("GET","object"==typeof e?e.url:e,!0),n.send()},RoutesLib=function(){var e={},t=/([^\\\/]+)\.\w+$/;return{register:function(t,n){e[t]=n instanceof Array?n:n.split(/[\{\}]/g)},resolve:function(t,n){var r,o,s,a,i,l,u,c,f=n.indexOf("?"),d=n.indexOf("::");if(-1!==d&&(r=n.substring(d+2),n=n.substring(0,d)),-1!==f){for(c=n.substring(f+1).split("&"),s={},i=0,u=c.length;u>i;i++)l=c[i].split("="),s[l[0]]=l[1];n=n.substring(0,f)}if(n=n.split("/"),a=e[t],null==a)return{path:n.join("/"),params:s,alias:r};for(o=a[0],i=1;a.length>i;i++)if(0===i%2)o+=a[i];else{var h=a[i]<<0;if(h>n.length-1&&(h=n.length-1),o+=n[h],i===a.length-2)for(h++;n.length>h;h++)o+="/"+n[h]}return{path:o,params:s,alias:r}},each:function(e,t,n,r,o){var s;if(null==t)return console.error("Include Item has no Data",e,r),void 0;if("lazy"!==e||null!=o)if(t instanceof Array)for(var a=0;t.length>a;a++)this.each(e,t[a],n,r,o);else if("object"!=typeof t){if("string"==typeof t){var i=this.resolve(r,t);return r&&(r+="."+t),n(r,i,o),void 0}console.error("Include Package is invalid",arguments)}else for(s in t)hasOwnProp.call(t,s)&&this.each(e,t[s],n,s,o);else for(s in t)this.each(e,t[s],n,null,s)},getRoutes:function(){return e},parseAlias:function(e){var n=e.path,r=t.exec(n);return r&&r[1]}}},Routes=RoutesLib(),Events=function(e){function t(){Events.ready=fn_doNothing,null!=n&&(arr_invoke(n),n=null)}if(null==e)return{ready:fn_doNothing,load:fn_doNothing};var n=[];return"onreadystatechange"in e?e.onreadystatechange=function(){/complete|interactive/g.test(e.readyState)!==!1&&t()}:e.addEventListener?e.addEventListener("DOMContentLoaded",t):window.onload=t,{ready:function(e){n.unshift(e)}}}(document),IncludeDeferred=function(){this.callbacks=[],this.state=0};IncludeDeferred.prototype={on:function(e,t,n){var r=3>this.state||this===n?"unshift":"push";return this.state>=e?t(this):this.callbacks[r]({state:e,callback:t}),this},readystatechanged:function(e){var t,n,r,o;if(e>this.state&&(this.state=e),3===this.state){var s=this.includes;if(null!=s&&s.length)for(t=0;s.length>t;t++)if(4!==s[t].resource.state)return;this.state=4}if(t=0,n=this.callbacks.length,0!==n){for("js"===this.type&&4===this.state&&(o=global.include,global.include=this);n>t&&(r=this.callbacks[t],null==r||r.state>this.state||(this.callbacks.splice(t,1),n--,t--,r.callback(this),!(4>this.state)));t++);null!=o&&(global.include=o)}},ready:function(e){var t=this;return this.on(4,function(){Events.ready(function(){t.resolve(e)})},this)},done:function(e){var t=this;return this.on(4,function(){t.resolve(e)},this)},resolve:function(e){var t=this.includes,n=null==t?0:t.length;if(n>0&&null==this.response){this.response={};for(var r,o,s,a=0;n>a;a++)if(s=t[a],r=s.resource,o=s.route,r.exports){var i=r.type;switch(i){case"js":case"load":case"ajax":var l=o.alias||Routes.parseAlias(o),u="js"===i?this.response:this.response[i]||(this.response[i]={});if(l){u[l]=r.exports;break}console.warn("Resource Alias is Not defined",r)}}}e(this.response)}};var Include=function(){function embedPlugin(source){eval(source)}function enableModules(){return Object.defineProperty===void 0?(console.warn("Browser do not support Object.defineProperty"),void 0):(Object.defineProperty(global,"module",{get:function(){return global.include}}),Object.defineProperty(global,"exports",{get:function(){var e=global.include;return e.exports||(e.exports={})},set:function(e){global.include.exports=e}}),void 0)}function includePackage(e,t,n){var r=1===n.length?n[0]:__array_slice.call(n);return e instanceof Resource?e.include(t,r):new Resource("js").include(t,r)}function createIncluder(e){return function(){return includePackage(this,e,arguments)}}function Include(){}for(var fns=["js","css","load","ajax","embed","lazy"],i=0,imax=fns.length,proto=Include.prototype;imax>i;i++)proto[fns[i]]=createIncluder(fns[i]);return proto.inject=proto.js,obj_inherit(Include,{setCurrent:function(e){var t=new Resource("js",{path:e.id},e.namespace,null,null,e.id);4!==t.state&&console.error("Current Resource should be loaded"),t.state=3,global.include=t},cfg:function(e){switch(typeof e){case"object":for(var t in e)cfg[t]=e[t],"modules"===t&&e[t]===!0&&enableModules();break;case"string":if(1===arguments.length)return cfg[e];2===arguments.length&&(cfg[e]=arguments[1]);break;case"undefined":return cfg}return this},routes:function(e){if(null==e)return Routes.getRoutes();if(2===arguments.length)return Routes.register(e,arguments[1]),this;for(var t in e)Routes.register(t,e[t]);return this},promise:function(e){for(var t=e.split("."),n=global;t.length;){var r=t.shift();n=n[r]||(n[r]={})}return n},register:function(e){for(var t in e)for(var n=0;e[t].length>n;n++){var r=e[t][n].id,o=e[t][n].url,s=e[t][n].namespace,a=new Resource;switch(a.state=4,a.namespace=s,a.type=t,o&&("/"===o[0]&&(o=o.substring(1)),a.location=path_getDir(o)),t){case"load":case"lazy":var i=document.querySelector("#includejs-"+r.replace(/\W/g,""));if(null==i)return console.error('"%s" Data was not embedded into html',r),void 0;a.exports=i.innerHTML}(bin[t]||(bin[t]={}))[r]=a}},instance:function(){var e;return e=new Resource,e.state=4,e},getResource:function(e,t){var n=("/"===e[0]?"":"/")+e;if(null!=t)return bin[t][n];for(var r in bin)if(bin[r].hasOwnProperty(n))return bin[r][n];return null},getResources:function(){return bin},plugin:function(e,t){var n=[],r=0,o=0,s=0,a=function(e,n){o++,embedPlugin(n),o===r-1&&t&&(t(),t=null)};for(Routes.each("",e,function(e,t){n.push("/"===t.path[0]?t.path.substring(1):t.path)}),r=n.length;r>s;s++)XHR(n[s],a);return this}}),Include}(),ScriptStack=function(){var e,t,n=[],r=function(t,n){var r=document.createElement("script");r.type="text/javascript",r.src=t,"onreadystatechange"in r?r.onreadystatechange=function(){("complete"===this.readyState||"loaded"===this.readyState)&&n()}:r.onload=r.onerror=n,(e||(e=document.getElementsByTagName("head")[0])).appendChild(r)},o=function(){function e(e){e&&"error"===e.type&&console.log("Script Loaded Error",s.url);for(var r=0,a=n.length;a>r;r++)if(n[r]===s){n.splice(r,1);break}return r===a?(console.error("Loaded Resource not found in stack",s),void 0):(s.readystatechanged(3),t=null,o(),void 0)}if(0!==n.length&&null==t){var s=t=n[0];if(1!==s.state)return s.state=1,global.include=s,global.iparams=s.route.params,s.source?(__eval(s.source,s),e(),void 0):(r(s.url,e),void 0)}},s=function(){if(0!==n.length&&null==t){var e=n[0];if(!(2>e.state)){t=e,e.state=1,global.include=e,__eval(e.source,e);for(var r,o=0,a=n.length;a>o;o++)if(r=n[o],r===e){n.splice(o,1);break}e.readystatechanged(3),t=null,s()}}};return{load:function(e,r,a){var i=!1;if(r)for(var l=0,u=n.length;u>l;l++)if(n[l]===r){n.splice(l,0,e),i=!0;break}return i||n.push(e),!cfg.eval||a?(o(),void 0):(cfg.sync===!0&&(t=null),e.source?(e.state=2,s(),void 0):(XHR(e,function(e,t){t||console.error("Not Loaded:",e.url),e.source=t,e.state=2,s()}),void 0))},moveToParent:function(e,t){var r,o=n.length,s=-1,a=-1;for(r=0;o>r;r++)if(n[r]===e){a=r;break}if(-1!==a){for(r=0;o>r;r++)if(n[r]===t){s=r;break}-1!==s&&(s>a||(n.splice(a,1),n.splice(s,0,e)))}}}}(),CustomLoader=function(){function e(e){var t=e.substring(e.lastIndexOf(".")+1);if(r.hasOwnProperty(t))return r[t];var n=cfg.loader[t],o=n,s=null;if("object"==typeof n)for(var a in n){s=a,o=n[a];break}return r[t]=new Resource("js",Routes.resolve(s,o),s)}function t(e,t,n){XHR(e,function(e,r){n(e,t.process(r,e))})}var n={process:function(e){try{return JSON.parse(e)}catch(t){return console.error(t,e),null}}},r={json:n};return cfg.loader={json:1},{load:function(n,r){var o=e(n.url);return o.process?(t(n,o,r),void 0):(o.done(function(){t(n,o.exports,r)}),void 0)},exists:function(e){if(!e.url||!cfg.loader)return!1;var t=e.url,n=t.substring(t.lastIndexOf(".")+1);return cfg.loader.hasOwnProperty(n)}}}(),LazyModule={create:function(e,t){for(var n=e.split("."),r=global,o=n[n.length-1];n.length>1;){var s=n.shift();r=r[s]||(r[s]={})}n=null,Object.defineProperty(r,o,{get:function(){delete r[o];try{var n=__eval(t,global.include);null==n||n instanceof Resource||(r[o]=n)}catch(s){s.xpath=e,Helper.reportError(s)}finally{return t=null,e=null,r[o]}}})}},Resource=function(e,t,n,r,o){function s(e){var t=e.type,n=e.parent,s=e.url;if(o.exists(e)===!1)switch(t){case"js":case"embed":r.load(e,n,"embed"===t);break;case"ajax":case"load":case"lazy":XHR(e,a);break;case"css":e.state=4;var i=document.createElement("link");i.href=s,i.rel="stylesheet",i.type="text/css",document.getElementsByTagName("head")[0].appendChild(i)}else o.load(e,a);return e}function a(e,t){if(!t)return console.warn("Resource cannt be loaded",e.url),e.readystatechanged(4),void 0;switch(e.type){case"js":case"embed":return e.source=t,r.load(e,e.parent,"embed"===e.type),void 0;case"load":case"ajax":e.exports=t;break;case"lazy":LazyModule.create(e.xpath,t);break;case"css":var n=document.createElement("style");n.type="text/css",n.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(n)}e.readystatechanged(4)}var i=function(n,o,a,i,l,u){e.call(this),t.call(this),this.childLoaded=fn_proxy(this.childLoaded,this);var c=o&&o.path;null!=c&&(this.url=c=path_resolveUrl(c,l)),this.route=o,this.namespace=a,this.type=n,this.xpath=i,this.parent=l,null==u&&c&&(u=("/"===c[0]?"":"/")+c);var f=bin[n]&&bin[n][u];return f?(4>f.state&&"js"===n&&r.moveToParent(f,l),f):null==c?(this.state=3,this.location=path_getDir(path_resolveCurrent()),this):(this.location=path_getDir(c),(bin[n]||(bin[n]={}))[u]=this,cfg.version&&(this.url+=(-1===this.url.indexOf("?")?"?":"&")+"v="+cfg.version),s(this))};return i.prototype=obj_inherit(i,t,e,{childLoaded:function(){var e=this,t=e.includes;if(t&&t.length){if(3>e.state)return;for(var n=0;t.length>n;n++)if(4!==t[n].resource.state)return}e.readystatechanged(4)},create:function(e,t,n,r,o){var s;return this.state=this.state>=3?3:2,this.response=null,null==this.includes&&(this.includes=[]),s=new i(e,t,n,r,this,o),this.includes.push({resource:s,route:t}),s},include:function(e,t){var r=this;return n.each(e,t,function(t,n,o){(null==r.route||r.route.path!==n.path)&&r.create(e,n,t,o).on(4,r.childLoaded)}),this}}),i}(Include,IncludeDeferred,Routes,ScriptStack,CustomLoader);exports.include=new Include,exports.includeLib={Routes:RoutesLib,Resource:Resource,ScriptStack:ScriptStack,registerLoader:CustomLoader.register}});