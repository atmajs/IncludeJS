var __eval=function(source,include){"use strict";return source||console.error("error",include),eval(source)};(function(e,t){"use strict";var n={},r=!!(e.location&&e.location.protocol&&/^https?:/.test(e.location.protocol)),i={eval:t==null},s={},o={}.hasOwnProperty,u=typeof IncludeRewrites!="undefined"?IncludeRewrites:null,a=null,f={uri:{getDir:function(e){var t=e.lastIndexOf("/");return t==-1?"":e.substring(t+1,-t)},resolveCurrent:function(){var e=t.querySelectorAll("script");return e[e.length-1].getAttribute("src")},resolveUrl:function(e,t){i.path&&e[0]=="/"&&(e=i.path+e.substring(1));if(e[0]=="/")return r===!1||i.lockedToFolder===!0?e.substring(1):e;switch(e.substring(0,4)){case"file":case"http":return e}return t!=null&&t.location!=null?t.location+e:e}},extend:function(e,t){for(var n in t)e[n]=t[n];return e},invokeEach:function(e,t){if(e==null)return;if(e instanceof Array)for(var n=0,r,i=e.length;n<i;n++)r=e[n],typeof r=="function"&&(t!=null?r.apply(this,t):r())},doNothing:function(e){typeof e=="function"&&e()},reportError:function(e){console.error("IncludeJS Error:",e,e.message,e.url),typeof s.onerror=="function"&&s.onerror(e)},ensureArray:function(e,t){if(!t)return e;var n=t.split(".");while(n.length-1){var r=n.shift();e=e[r]||(e[r]={})}return e[n.shift()]=[]},xhr:function(e,t){var n=new XMLHttpRequest,r=Date.now();n.onreadystatechange=function(){n.readyState==4&&t&&t(e,n.responseText)},n.open("GET",e,!0),n.send()}},l=function(){var e={};return{register:function(t,n){e[t]=n instanceof Array?n:n.split(/[\{\}]/g)},resolve:function(t,n){var r=n.indexOf("?"),i,s,o,u,a,f;if(~r){var l=n.substring(r+1).split("&");s={};for(u=0,f=l.length;u<f;u++)a=l[u].split("="),s[a[0]]=a[1];n=n.substring(0,r)}n=n.split("/"),o=e[t];if(o==null)return{path:n,params:s};i=o[0];for(u=1;u<o.length;u++)if(u%2===0)i+=o[u];else{var c=o[u]<<0;c>n.length-1&&(c=n.length-1),i+=n[c];if(u==o.length-2)for(c++;c<n.length;c++)i+="/"+n[c]}return{path:i,params:s}},each:function(e,t,n,r,i){var s;if(t==null){console.error("Include Item has no Data",e,r);return}if(e=="lazy"&&i==null){for(s in t)this.each(e,t[s],n,null,s);return}if(t instanceof Array){for(var u=0;u<t.length;u++)this.each(e,t[u],n,r,i);return}if(typeof t=="object"){for(s in t)o.call(t,s)&&this.each(e,t[s],n,s,i);return}if(typeof t=="string"){var a=t;r?(a=this.resolve(r,t),r+="."+t):a={path:a},n(r,a,i);return}console.error("Include Package is invalid",arguments)},getRoutes:function(){return e}}}(),c=function(e){if(e==null)return{ready:f.doNothing,load:f.doNothing};var t=[],n=null,r=Date.now();return e.onreadystatechange=function(){if(/complete|interactive/g.test(e.readyState)===!1)return;r&&console.log("DOMContentLoader",e.readyState,Date.now()-r,"ms"),c.ready=f.doNothing,f.invokeEach(t),t=null,e.readyState=="complete"&&(c.load=f.doNothing,f.invokeEach(n),n=null)},{ready:function(e){t.unshift(e)},load:function(e){(n||(n=[])).unshift(e)}}}(t),h=Class({Construct:function(){this.callbacks=[]},on:function(e,t){return e<=this.state?t(this):this.callbacks.unshift({state:e,callback:t}),this},readystatechanged:function(e){this.state=e;for(var t=0,n,r=this.callbacks.length;t<r;t++){n=this.callbacks[t];if(n.state>this.state||n.callback==null)continue;n.callback(this),n.callback=null}},ready:function(e){return this.on(4,function(){c.ready(this.resolve.bind(this,e))}.bind(this))},loaded:function(e){return this.on(4,function(){c.load(e)})},done:function(e){return this.on(4,this.resolve.bind(this,e))},resolve:function(e){var t=e(this.response);t!=null&&(this.obj=t)}}),p=Class({setCurrent:function(e){a=e},incl:function(e,t){if(this instanceof v)return this.include(e,t);var n=new v;return a&&(n.id=a.id,n.url=a.url,n.namespace=a.namespace,n.location=f.uri.getDir(n.url)),n.include(e,t)},js:function(e){return this.incl("js",e)},css:function(e){return this.incl("css",e)},load:function(e){return this.incl("load",e)},ajax:function(e){return this.incl("ajax",e)},embed:function(e){return this.incl("embed",e)},lazy:function(e){return this.incl("lazy",e)},cfg:function(e){switch(typeof e){case"object":for(var t in e)i[t]=e[t];break;case"string":if(arguments.length==1)return i[e];arguments.length==2&&(i[e]=arguments[1]);break;case"undefined":return i}return this},routes:function(e){if(e==null)return l.getRoutes();for(var t in e)l.register(t,e[t]);return this},promise:function(t){var n=t.split("."),r=e;while(n.length){var i=n.shift();r=r[i]||(r[i]={})}return r},register:function(e){for(var r in e)for(var i=0;i<e[r].length;i++){var s=e[r][i].id,o=e[r][i].url,u=e[r][i].namespace,a=new v;a.state=4,a.namespace=u,a.type=r,o&&(o[0]=="/"&&(o=o.substring(1)),a.location=f.uri.getDir(o));switch(r){case"load":case"lazy":var l=t.querySelector("#includejs-"+s);if(l==null){console.error('"%s" Data was not embedded into html',s);return}a.obj=l.innerHTML}(n[r]||(n[r]={}))[s]=a}}}),d=function(){var n,r=[],s=function(e,r){var i=t.createElement("script");i.type="application/javascript",i.src=e,i.onload=i.onerror=r,(n||(n=t.querySelector("head"))).appendChild(i)},o=function(e){var t=e.includes;if(t!=null&&t.length)for(var n=0;n<t.length;n++)if(t[n].state!=4)return;e.readystatechanged(4)},u=function(){if(r.length===0)return;var t=r[0];if(t.state===1)return;t.state=1,e.include=t,s(t.url,function(e){for(var n=0,i=r.length;n<i;n++)if(r[n]===t){r.splice(n,1);break}t.state=3,o(t),u()})},a=function(){var e=r[0];if(e&&e.state>2){e.state=0;try{__eval(e.source,e)}catch(t){t.url=e.url,f.reportError(t)}for(var n=0,i,s=r.length;n<s;n++){i=r[n];if(i==e){r.splice(n,1);break}}e.state=3,o(e),a()}};return{load:function(e,t){var n=!1;if(t)for(var s=0,o=r.length;s<o;s++)if(r[s]===t){r.splice(s,0,e),n=!0;break}n||r.push(e),i.eval?f.xhr(e.url,function(t,n){n||console.error("Not Loaded:",t),e.source=n,e.readystatechanged(3),a()}):u()}}}(),v=Class({Base:p,Extends:h,Construct:function(e,r,i,s,o,a){if(e==null)return this;var l=r&&r.path;this.namespace=i,this.type=e,this.xpath=s,this.url=l,l!=null&&(this.url=f.uri.resolveUrl(l,o)),a||(i?a=i:l[0]=="/"?a=l:o&&o.namespace?a=o.namespace+"/"+l:o&&o.location?a="/"+o.location.replace(/^[\/]+/,"")+l:o&&o.id?a=o.id+"/"+l:a="/"+l);if(n[e]&&n[e][a])return n[e][a];u!=null&&u[a]!=null?l=u[a]:l=this.url,this.location=f.uri.getDir(l),(n[e]||(n[e]={}))[a]=this;var c;switch(e){case"js":d.load(this,o);break;case"ajax":case"load":case"lazy":f.xhr(l,this.onXHRLoaded.bind(this));break;case"css":this.state=4,c=t.createElement("link"),c.href=l,c.rel="stylesheet",c.type="text/css";break;case"embed":c=t.createElement("script"),c.type="application/javascript",c.src=l,c.onload=c.onerror=this.readystatechanged.bind(this,4)}return c!=null&&(t.querySelector("head").appendChild(c),c=null),this},include:function(e,t){return this.state=0,this.includes==null&&(this.includes=[]),l.each(e,t,function(t,n,r){var i=new v(e,n,t,r,this);this.includes.push(i),i.index=this.calcIndex(e,t),i.on(4,this.childLoaded.bind(this))}.bind(this)),this},calcIndex:function(e,t){this.response==null&&(this.response={});switch(e){case"js":case"load":case"ajax":var n=e+"Index";return this.response[n]==null&&(this.response[n]=-1),++this.response[n]}return-1},childLoaded:function(e){if(e!=null&&e.obj!=null&&e.obj instanceof p==0)switch(e.type){case"js":case"load":case"ajax":var t=this.response[e.type]||(this.response[e.type]=[]);e.namespace!=null&&(t=f.ensureArray(t,e.namespace)),t[e.index]=e.obj}var n=this.includes;if(n&&n.length)for(var r=0;r<n.length;r++)if(n[r].state!=4)return;this.readystatechanged(4)},onXHRLoaded:function(e,t){if(t)switch(this.type){case"load":case"ajax":this.obj=t;break;case"lazy":m.create(this.xpath,t)}else console.warn("Resource cannt be loaded",this.url);this.readystatechanged(4)}}),m={create:function(t,n){var r=t.split("."),i=e,s=r[r.length-1];while(r.length>1){var o=r.shift();i=i[o]||(i[o]={})}r=null,Object.defineProperty(i,s,{get:function(){delete i[s];try{var r=__eval(n,e.include);r==null||r instanceof v||(i[s]=r)}catch(o){o.xpath=t,f.reportError(o)}finally{return n=null,t=null,i[s]}}})}};e.include=new p,e.include.helper=f,e.include.Routes=l,e.IncludeResource=v})(window,typeof document=="undefined"?null:document);