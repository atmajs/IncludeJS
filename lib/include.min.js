var __eval=function(source,include){"use strict";var iparams=include.route.params;return eval(source)};(function(e,t){"use strict";var n={},r=!!(e.location&&e.location.protocol&&/^https?:/.test(e.location.protocol)),i={eval:t==null},s={},o={}.hasOwnProperty,u=e.XMLHttpRequest,a={uri:{getDir:function(e){var t=e.lastIndexOf("/");return t==-1?"":e.substring(t+1,-t)},resolveCurrent:function(){var e=t.querySelectorAll("script");return e[e.length-1].getAttribute("src")},resolveUrl:function(e,t){i.path&&e[0]=="/"&&(e=i.path+e.substring(1));if(e[0]=="/")return r===!1||i.lockedToFolder===!0?e.substring(1):e;switch(e.substring(0,5)){case"file:":case"http:":return e}return t!=null&&t.location!=null?t.location+e:e}},extend:function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];typeof n=="function"&&(n=n.prototype);for(var r in n)e[r]=n[r]}return e},invokeEach:function(e,t){if(e==null)return;if(e instanceof Array)for(var n=0,r,i=e.length;n<i;n++)r=e[n],typeof r=="function"&&(t!=null?r.apply(this,t):r())},doNothing:function(e){typeof e=="function"&&e()},reportError:function(e){console.error("IncludeJS Error:",e,e.message,e.url),typeof s.onerror=="function"&&s.onerror(e)},ensureArray:function(e,t){if(!t)return e;var n=t.split(".");while(n.length-1){var r=n.shift();e=e[r]||(e[r]={})}return e[n.shift()]=[]},xhr:function(e,t){var n=new u,r=Date.now();n.onreadystatechange=function(){n.readyState==4&&t&&t(e,n.responseText)},n.open("GET",e,!0),n.send()}},f=function(){var e={},t=/([^\\\/]+)\.\w+$/;return{register:function(t,n){e[t]=n instanceof Array?n:n.split(/[\{\}]/g)},resolve:function(t,n){var r=n.indexOf("?"),i=n.indexOf("::"),s,o,u,a,f,l,c;~i&&(s=n.substring(i+2),n=n.substring(0,i));if(~r){var h=n.substring(r+1).split("&");u={};for(f=0,c=h.length;f<c;f++)l=h[f].split("="),u[l[0]]=l[1];n=n.substring(0,r)}n=n.split("/"),a=e[t];if(a==null)return{path:n.join("/"),params:u,alias:s};o=a[0];for(f=1;f<a.length;f++)if(f%2===0)o+=a[f];else{var p=a[f]<<0;p>n.length-1&&(p=n.length-1),o+=n[p];if(f==a.length-2)for(p++;p<n.length;p++)o+="/"+n[p]}return{path:o,params:u,alias:s}},each:function(e,t,n,r,i){var s;if(t==null){console.error("Include Item has no Data",e,r);return}if(e=="lazy"&&i==null){for(s in t)this.each(e,t[s],n,null,s);return}if(t instanceof Array){for(var u=0;u<t.length;u++)this.each(e,t[u],n,r,i);return}if(typeof t=="object"){for(s in t)o.call(t,s)&&this.each(e,t[s],n,s,i);return}if(typeof t=="string"){var a=this.resolve(r,t);r&&(r+="."+t),n(r,a,i);return}console.error("Include Package is invalid",arguments)},getRoutes:function(){return e},parseAlias:function(e){var n=e.url,r=t.exec(n);return r&&r[1]}}},l=f(),c=function(e){if(e==null)return{ready:a.doNothing,load:a.doNothing};var t=[],n=null,r=Date.now();return e.onreadystatechange=function(){if(/complete|interactive/g.test(e.readyState)===!1)return;r&&console.log("DOMContentLoader",e.readyState,Date.now()-r,"ms"),c.ready=a.doNothing,a.invokeEach(t),t=null,e.readyState=="complete"&&(c.load=a.doNothing,a.invokeEach(n),n=null)},{ready:function(e){t.unshift(e)},load:function(e){(n||(n=[])).unshift(e)}}}(t),h=function(){this.callbacks=[],this.state=0};h.prototype={on:function(e,t){return e<=this.state?t(this):this.callbacks.unshift({state:e,callback:t}),this},readystatechanged:function(t){var n,r,i;if(t>this.state){this.state=t;if(this.state===3){var s=this.includes;if(s!=null&&s.length)for(n=0;n<s.length;n++)if(s[n].state!=4)return;this.state=4}this.state===4&&(e.include=this)}for(n=0,i=this.callbacks.length;n<i;n++){r=this.callbacks[n];if(r.state>this.state||r.callback==null)continue;r.callback(this),r.callback=null}},ready:function(e){return this.on(4,function(){c.ready(this.resolve.bind(this,e))}.bind(this))},loaded:function(e){return this.on(4,function(){c.load(e)})},done:function(e){return this.on(4,this.resolve.bind(this,e))},resolve:function(e){e(this.response)}};var p=function(){};p.prototype={setCurrent:function(t){var n=new v("js",{path:t.id},t.namespace,null,null,t.id);n.state!=4&&console.error("Current Resource should be loaded"),n.state=2,e.include=n},incl:function(e,t){if(this instanceof v)return this.include(e,t);var n=new v;return n.include(e,t)},js:function(e){return this.incl("js",e)},css:function(e){return this.incl("css",e)},load:function(e){return this.incl("load",e)},ajax:function(e){return this.incl("ajax",e)},embed:function(e){return this.incl("embed",e)},lazy:function(e){return this.incl("lazy",e)},cfg:function(e){switch(typeof e){case"object":for(var t in e)i[t]=e[t];break;case"string":if(arguments.length==1)return i[e];arguments.length==2&&(i[e]=arguments[1]);break;case"undefined":return i}return this},routes:function(e){if(e==null)return l.getRoutes();for(var t in e)l.register(t,e[t]);return this},promise:function(t){var n=t.split("."),r=e;while(n.length){var i=n.shift();r=r[i]||(r[i]={})}return r},register:function(e){for(var r in e)for(var i=0;i<e[r].length;i++){var s=e[r][i].id,o=e[r][i].url,u=e[r][i].namespace,f=new v;f.state=4,f.namespace=u,f.type=r,o&&(o[0]=="/"&&(o=o.substring(1)),f.location=a.uri.getDir(o));switch(r){case"load":case"lazy":var l=t.querySelector("#includejs-"+s.replace(/\W/g,""));if(l==null){console.error('"%s" Data was not embedded into html',s);return}f.exports=l.innerHTML}(n[r]||(n[r]={}))[s]=f}},instance:function(){return new v}};var d=function(){var n,r,s=[],o=function(e,r){var i=t.createElement("script");i.type="text/javascript",i.src=e,"onreadystatechange"in i?i.onreadystatechange=function(){(this.readyState=="complete"||this.readyState=="loaded")&&r()}:i.onload=i.onerror=r,(n||(n=t.getElementsByTagName("head")[0])).appendChild(i)},u=function(){if(s.length===0)return;if(r!=null)return;var t=r=s[0];if(t.state===1)return;t.state=1,e.include=t,e.iparams=t.route.params,o(t.url,function(e){e&&e.type=="error"&&console.log("Script Loaded Error",t.url);for(var n=0,i=s.length;n<i;n++)if(s[n]===t){s.splice(n,1);break}t.readystatechanged(3),r=null,u()})},f=function(){if(s.length===0)return;if(r!=null)return;var t=s[0];if(t&&t.state>1){r=t,t.state=1,e.include=t;try{__eval(t.source,t)}catch(n){n.url=t.url,a.reportError(n)}for(var i=0,o,u=s.length;i<u;i++){o=s[i];if(o==t){s.splice(i,1);break}}t.readystatechanged(3),r=null,f()}};return{load:function(e,t,n){var r=!1;if(t)for(var o=0,l=s.length;o<l;o++)if(s[o]===t){s.splice(o,0,e),r=!0;break}r||s.push(e);if(!i.eval||n){u();return}a.xhr(e.url,function(t,n){n||console.error("Not Loaded:",t),e.source=n,e.state=2,f()})}}}(),v=function(e,r,i,s,o,u){p.call(this),h.call(this);var f=r&&r.path;f!=null&&(this.url=f=a.uri.resolveUrl(f,o)),this.route=r,this.namespace=i,this.type=e,this.xpath=s,u==null&&f&&(u=(f[0]=="/"?"":"/")+f);var l=n[e]&&n[e][u];if(l)return l.route=r,l;if(f==null)return this.state=3,this;this.location=a.uri.getDir(f),(n[e]||(n[e]={}))[u]=this;if(g.hanlder(l)===!0)return this;var c;switch(e){case"js":case"embed":d.load(this,o,e=="embed");break;case"ajax":case"load":case"lazy":a.xhr(f,this.onXHRLoaded.bind(this));break;case"css":this.state=4,c=t.createElement("link"),c.href=f,c.rel="stylesheet",c.type="text/css"}return c!=null&&(t.getElementsByTagName("head")[0].appendChild(c),c=null),this};v.prototype=a.extend({},h,p,{include:function(e,t){return this.state=this.state>=3?3:1,this.includes==null&&(this.includes=[]),this.response==null&&(this.response={}),l.each(e,t,function(t,n,r){var i=new v(e,n,t,r,this);this.includes.push(i),i.on(4,this.childLoaded.bind(this))}.bind(this)),this},childLoaded:function(e){if(e&&e.exports){var t=e.type;switch(t){case"js":case"load":case"ajax":var n=e.route.alias||l.parseAlias(e),r=t=="js"?this.response:this.response[t]||(this.response[t]={});if(n){r[n]=e.exports;break}console.warn("Resource Alias is Not defined",e)}}var i=this.includes;if(i&&i.length){if(this.state<3)return;for(var s=0;s<i.length;s++)if(i[s].state!=4)return}this.readystatechanged(4)},onXHRLoaded:function(e,t){if(t)switch(this.type){case"load":case"ajax":this.exports=t;break;case"lazy":m.create(this.xpath,t)}else console.warn("Resource cannt be loaded",this.url);this.readystatechanged(4)}});var m={create:function(t,n){var r=t.split("."),i=e,s=r[r.length-1];while(r.length>1){var o=r.shift();i=i[o]||(i[o]={})}r=null,Object.defineProperty(i,s,{get:function(){delete i[s];try{var r=__eval(n,e.include);r==null||r instanceof v||(i[s]=r)}catch(o){o.xpath=t,a.reportError(o)}finally{return n=null,t=null,i[s]}}})}},g=function(){var e={};return{handle:function(t){var n=t.url,r=n.substring(n.lastIndexOf(".")+1);return e.hasOwnProperty(r)===!1?!1:(a.xhr(t.url,function(n,i){t.source=t,e[r](t),t.readystatechanged(3)}),!0)},register:function(t,n){e[t]=n}}}();e.include=new p,e.includeLib={Helper:a,Routes:f,Resource:v,ScriptStack:d,registerLoader:g.register}})(typeof window=="undefined"?global:window,typeof document=="undefined"?null:document);