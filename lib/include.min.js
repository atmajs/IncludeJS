var __eval=function(source,include){"use strict";var iparams=include.route.params;try{return eval(source)}catch(error){error.url=include.url,console.error(error)}};(function(e,t){"use strict";var n={},r=!!(e.location&&e.location.protocol&&/^https?:/.test(e.location.protocol)),i={eval:t==null},s={},o={}.hasOwnProperty,u=e.XMLHttpRequest,a={uri:{getDir:function(e){var t=e.lastIndexOf("/");return t==-1?"":e.substring(t+1,-t)},resolveCurrent:function(){var e=t.getElementsByTagName("script");return e[e.length-1].getAttribute("src")},resolveUrl:function(e,t){i.path&&e[0]=="/"&&(e=i.path+e.substring(1));if(e[0]=="/")return r===!1||i.lockedToFolder===!0?e.substring(1):e;switch(e.substring(0,5)){case"file:":case"http:":return e}return t!=null&&t.location!=null?t.location+e:e}},extend:function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];typeof n=="function"&&(n=n.prototype);for(var r in n)e[r]=n[r]}return e},invokeEach:function(e,t){if(e==null)return;if(e instanceof Array)for(var n=0,r,i=e.length;n<i;n++)r=e[n],typeof r=="function"&&(t!=null?r.apply(this,t):r())},doNothing:function(e){typeof e=="function"&&e()},reportError:function(e){console.error("IncludeJS Error:",e,e.message,e.url),typeof s.onerror=="function"&&s.onerror(e)},ensureArray:function(e,t){if(!t)return e;var n=t.split(".");while(n.length-1){var r=n.shift();e=e[r]||(e[r]={})}return e[n.shift()]=[]}},f=function(e,t){var n=new u,r=Date.now();n.onreadystatechange=function(){n.readyState==4&&t&&t(e,n.responseText)},n.open("GET",e.url,!0),n.send()},l=function(){var e={},t=/([^\\\/]+)\.\w+$/;return{register:function(t,n){e[t]=n instanceof Array?n:n.split(/[\{\}]/g)},resolve:function(t,n){var r=n.indexOf("?"),i=n.indexOf("::"),s,o,u,a,f,l,c;~i&&(s=n.substring(i+2),n=n.substring(0,i));if(~r){var h=n.substring(r+1).split("&");u={};for(f=0,c=h.length;f<c;f++)l=h[f].split("="),u[l[0]]=l[1];n=n.substring(0,r)}n=n.split("/"),a=e[t];if(a==null)return{path:n.join("/"),params:u,alias:s};o=a[0];for(f=1;f<a.length;f++)if(f%2===0)o+=a[f];else{var p=a[f]<<0;p>n.length-1&&(p=n.length-1),o+=n[p];if(f==a.length-2)for(p++;p<n.length;p++)o+="/"+n[p]}return{path:o,params:u,alias:s}},each:function(e,t,n,r,i){var s;if(t==null){console.error("Include Item has no Data",e,r);return}if(e=="lazy"&&i==null){for(s in t)this.each(e,t[s],n,null,s);return}if(t instanceof Array){for(var u=0;u<t.length;u++)this.each(e,t[u],n,r,i);return}if(typeof t=="object"){for(s in t)o.call(t,s)&&this.each(e,t[s],n,s,i);return}if(typeof t=="string"){var a=this.resolve(r,t);r&&(r+="."+t),n(r,a,i);return}console.error("Include Package is invalid",arguments)},getRoutes:function(){return e},parseAlias:function(e){var n=e.path,r=t.exec(n);return r&&r[1]}}},c=l(),h=function(e){if(e==null)return{ready:a.doNothing,load:a.doNothing};var t=[],n=null,r=Date.now();return e.onreadystatechange=function(){if(/complete|interactive/g.test(e.readyState)===!1)return;r&&console.log("DOMContentLoader",e.readyState,Date.now()-r,"ms"),h.ready=a.doNothing,a.invokeEach(t),t=null,e.readyState=="complete"&&(h.load=a.doNothing,a.invokeEach(n),n=null)},{ready:function(e){t.unshift(e)},load:function(e){(n||(n=[])).unshift(e)}}}(t),p=function(){this.callbacks=[],this.state=0};p.prototype={on:function(e,t){return e<=this.state?t(this):this.callbacks.unshift({state:e,callback:t}),this},readystatechanged:function(t){var n,r,i,s;if(t>this.state){this.state=t;if(this.state===3){var o=this.includes;if(o!=null&&o.length)for(n=0;n<o.length;n++)if(o[n].resource.state!=4)return;this.state=4}}n=0,r=this.callbacks.length;if(r===0)return;this.type==="js"&&this.state===4&&(s=e.include,e.include=this);for(;n<r;n++){i=this.callbacks[n];if(i.state>this.state)continue;this.callbacks.splice(n,1),r--,n--;try{i.callback(this)}catch(u){console.error(u.toString(),"file:",this.url)}if(this.state<4)break}s!=null&&(e.include=s)},ready:function(e){return this.on(4,function(){h.ready(this.resolve.bind(this,e))}.bind(this))},loaded:function(e){return this.on(4,function(){h.load(e)})},done:function(e){return this.on(4,this.resolve.bind(this,e))},resolve:function(e){if(this.includes.length>0&&this.response==null){this.response={};var t,n;for(var r=0,i,s=this.includes.length;r<s;r++){i=this.includes[r],t=i.resource,n=i.route;if(!t.exports)continue;var o=t.type;switch(o){case"js":case"load":case"ajax":var u=n.alias||c.parseAlias(n),a=o=="js"?this.response:this.response[o]||(this.response[o]={});if(u){a[u]=t.exports;break}console.warn("Resource Alias is Not defined",t)}}}e(this.response)}};var d=function(){};d.prototype={setCurrent:function(t){var n=new y("js",{path:t.id},t.namespace,null,null,t.id);n.state!=4&&console.error("Current Resource should be loaded"),n.state=2,e.include=n},incl:function(e,t){if(this instanceof y)return this.include(e,t);var n=new y;return n.type="js",n.include(e,t)},js:function(e){return this.incl("js",e)},css:function(e){return this.incl("css",e)},load:function(e){return this.incl("load",e)},ajax:function(e){return this.incl("ajax",e)},embed:function(e){return this.incl("embed",e)},lazy:function(e){return this.incl("lazy",e)},cfg:function(e){switch(typeof e){case"object":for(var t in e)i[t]=e[t];break;case"string":if(arguments.length==1)return i[e];arguments.length==2&&(i[e]=arguments[1]);break;case"undefined":return i}return this},routes:function(e){if(e==null)return c.getRoutes();for(var t in e)c.register(t,e[t]);return this},promise:function(t){var n=t.split("."),r=e;while(n.length){var i=n.shift();r=r[i]||(r[i]={})}return r},register:function(e){for(var r in e)for(var i=0;i<e[r].length;i++){var s=e[r][i].id,o=e[r][i].url,u=e[r][i].namespace,f=new y;f.state=4,f.namespace=u,f.type=r,o&&(o[0]=="/"&&(o=o.substring(1)),f.location=a.uri.getDir(o));switch(r){case"load":case"lazy":var l=t.querySelector("#includejs-"+s.replace(/\W/g,""));if(l==null){console.error('"%s" Data was not embedded into html',s);return}f.exports=l.innerHTML}(n[r]||(n[r]={}))[s]=f}},instance:function(){return new y}};var v=function(){var n,r,s=[],o=function(e,r){var i=t.createElement("script");i.type="text/javascript",i.src=e,"onreadystatechange"in i?i.onreadystatechange=function(){(this.readyState=="complete"||this.readyState=="loaded")&&r()}:i.onload=i.onerror=r,(n||(n=t.getElementsByTagName("head")[0])).appendChild(i)},u=function(){function n(e){e&&e.type=="error"&&console.log("Script Loaded Error",t.url);var n=0,i=s.length;for(;n<i;n++)if(s[n]===t){s.splice(n,1);break}if(n==i){console.error("Loaded Resource not found in stack",t);return}t.readystatechanged(3),r=null,u()}if(s.length===0)return;if(r!=null)return;var t=r=s[0];if(t.state===1)return;t.state=1,e.include=t,e.iparams=t.route.params;if(t.source){__eval(t.source,t),n();return}o(t.url,n)},a=function(){if(s.length===0)return;if(r!=null)return;var t=s[0];if(t.state<2)return;r=t,t.state=1,e.include=t,__eval(t.source,t);for(var n=0,i,o=s.length;n<o;n++){i=s[n];if(i==t){s.splice(n,1);break}}t.readystatechanged(3),r=null,a()};return{load:function(e,t,n){var r=!1;if(t)for(var o=0,l=s.length;o<l;o++)if(s[o]===t){s.splice(o,0,e),r=!0;break}r||s.push(e);if(!i.eval||n){u();return}if(e.source){e.state=2,a();return}f(e,function(e,t){t||console.error("Not Loaded:",e.url),e.source=t,e.state=2,a()})},moveToParent:function(e,t){var n,r,i,o=2;for(n=0,i,r=s.length;n<r&&o;n++)i=s[n],i===e&&(s.splice(n,1),r--,n--,o--),i===t&&(s.splice(n,0,e),r++,n++,o--);t==null&&s.unshift(e)}}}(),m=function(){function t(t){var n=t.substring(t.lastIndexOf(".")+1);if(e.hasOwnProperty(n))return e[n];var r=i.loader[n],s,o;if(typeof r=="object")for(var u in r){o=u,s=r[u];break}return e[n]=new y("js",c.resolve(o,s),o)}var e={};return{load:function(e,n){var r=t(e.url);r.done(function(){f(e,function(e,t){n(e,r.exports.process(t,e))})})},exists:function(e){if(!e.url||!i.loader)return!1;var t=e.url,n=t.substring(t.lastIndexOf(".")+1);return i.loader.hasOwnProperty(n)}}}(),g={create:function(t,n){var r=t.split("."),i=e,s=r[r.length-1];while(r.length>1){var o=r.shift();i=i[o]||(i[o]={})}r=null,Object.defineProperty(i,s,{get:function(){delete i[s];try{var r=__eval(n,e.include);r==null||r instanceof y||(i[s]=r)}catch(o){o.xpath=t,a.reportError(o)}finally{return n=null,t=null,i[s]}}})}},y=function(e,r,i,s,o){function u(e,n){var r=e.type,i=e.parent,u=e.url;if(o.exists(e)===!1)switch(r){case"js":case"embed":s.load(e,i,r=="embed");break;case"ajax":case"load":case"lazy":f(e,l);break;case"css":e.state=4;var a=t.createElement("link");a.href=u,a.rel="stylesheet",a.type="text/css",t.getElementsByTagName("head")[0].appendChild(a)}else o.load(e,l);return e}function l(e,n){if(!n){console.warn("Resource cannt be loaded",e.url),e.readystatechanged(4);return}switch(e.type){case"js":case"embed":e.source=n,s.load(e,e.parent,e.type=="embed");return;case"load":case"ajax":e.exports=n;break;case"lazy":g.create(e.xpath,n);break;case"css":var r=t.createElement("style");r.type="text/css",r.innerHTML=n,t.getElementsByTagName("head")[0].appendChild(r)}e.readystatechanged(4)}function c(e,t){var n=e.includes;if(n&&n.length){if(e.state<3)return;for(var r=0;r<n.length;r++)if(n[r].resource.state!=4)return}e.readystatechanged(4)}var h=function(t,i,o,f,l,c){e.call(this),r.call(this);var h=i&&i.path;h!=null&&(this.url=h=a.uri.resolveUrl(h,l)),this.route=i,this.namespace=o,this.type=t,this.xpath=f,this.parent=l,c==null&&h&&(c=(h[0]=="/"?"":"/")+h);var p=n[t]&&n[t][c];return p?(p.state===0&&t=="js"&&s.moveToParent(p,l),p):h==null?(this.state=3,this):(this.location=a.uri.getDir(h),(n[t]||(n[t]={}))[c]=this,u(this))};return h.prototype=a.extend({},r,e,{include:function(e,t){this.state=this.state>=3?3:1,this.includes==null&&(this.includes=[]),this.childLoaded==null&&(this.childLoaded=c.bind(this,this)),this.response=null;var n=c.bind(this);return i.each(e,t,function(t,n,r){var i=new h(e,n,t,r,this);this.includes.push({resource:i,route:n}),i.on(4,this.childLoaded)}.bind(this)),this}}),h}(d,p,c,v,m);e.include=new d,e.includeLib={Helper:a,Routes:l,Resource:y,ScriptStack:v,registerLoader:m.register}})(typeof window=="undefined"?global:window,typeof document=="undefined"?null:document);