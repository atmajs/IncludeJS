var __eval=function(source,include){"use strict";source||console.error("error",include);var iparams=include.route.params;return eval(source)};(function(e,t){"use strict";var n={},r=!!(e.location&&e.location.protocol&&/^https?:/.test(e.location.protocol)),i={eval:t==null},s={},o={}.hasOwnProperty,u=typeof IncludeRewrites!="undefined"?IncludeRewrites:null,a=null,f=e.XMLHttpRequest,l={uri:{getDir:function(e){var t=e.lastIndexOf("/");return t==-1?"":e.substring(t+1,-t)},resolveCurrent:function(){var e=t.querySelectorAll("script");return e[e.length-1].getAttribute("src")},resolveUrl:function(e,t){i.path&&e[0]=="/"&&(e=i.path+e.substring(1));if(e[0]=="/")return r===!1||i.lockedToFolder===!0?e.substring(1):e;switch(e.substring(0,4)){case"file":case"http":return e}return t!=null&&t.location!=null?t.location+e:e}},extend:function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];typeof n=="function"&&(n=n.prototype);for(var r in n)e[r]=n[r]}return e},invokeEach:function(e,t){if(e==null)return;if(e instanceof Array)for(var n=0,r,i=e.length;n<i;n++)r=e[n],typeof r=="function"&&(t!=null?r.apply(this,t):r())},doNothing:function(e){typeof e=="function"&&e()},reportError:function(e){console.error("IncludeJS Error:",e,e.message,e.url),typeof s.onerror=="function"&&s.onerror(e)},ensureArray:function(e,t){if(!t)return e;var n=t.split(".");while(n.length-1){var r=n.shift();e=e[r]||(e[r]={})}return e[n.shift()]=[]},xhr:function(e,t){var n=new f,r=Date.now();n.onreadystatechange=function(){n.readyState==4&&t&&t(e,n.responseText)},n.open("GET",e,!0),n.send()}},c=function(){var e={};return{register:function(t,n){e[t]=n instanceof Array?n:n.split(/[\{\}]/g)},resolve:function(t,n){var r=n.indexOf("?"),i=n.indexOf("::"),s,o,u,a,f,l,c;~i&&(s=n.substring(i+2),n=n.substring(0,i));if(~r){var h=n.substring(r+1).split("&");u={};for(f=0,c=h.length;f<c;f++)l=h[f].split("="),u[l[0]]=l[1];n=n.substring(0,r)}n=n.split("/"),a=e[t];if(a==null)return{path:n.join("/"),params:u,alias:s};o=a[0];for(f=1;f<a.length;f++)if(f%2===0)o+=a[f];else{var p=a[f]<<0;p>n.length-1&&(p=n.length-1),o+=n[p];if(f==a.length-2)for(p++;p<n.length;p++)o+="/"+n[p]}return{path:o,params:u,alias:s}},each:function(e,t,n,r,i){var s;if(t==null){console.error("Include Item has no Data",e,r);return}if(e=="lazy"&&i==null){for(s in t)this.each(e,t[s],n,null,s);return}if(t instanceof Array){for(var u=0;u<t.length;u++)this.each(e,t[u],n,r,i);return}if(typeof t=="object"){for(s in t)o.call(t,s)&&this.each(e,t[s],n,s,i);return}if(typeof t=="string"){var a=this.resolve(r,t);r&&(r+="."+t),n(r,a,i);return}console.error("Include Package is invalid",arguments)},getRoutes:function(){return e}}}(),h=function(e){if(e==null)return{ready:l.doNothing,load:l.doNothing};var t=[],n=null,r=Date.now();return e.onreadystatechange=function(){if(/complete|interactive/g.test(e.readyState)===!1)return;r&&console.log("DOMContentLoader",e.readyState,Date.now()-r,"ms"),h.ready=l.doNothing,l.invokeEach(t),t=null,e.readyState=="complete"&&(h.load=l.doNothing,l.invokeEach(n),n=null)},{ready:function(e){t.unshift(e)},load:function(e){(n||(n=[])).unshift(e)}}}(t),p=function(){this.callbacks=[]};p.prototype={on:function(e,t){return e<=this.state?t(this):this.callbacks.unshift({state:e,callback:t}),this},readystatechanged:function(e){this.state=e;for(var t=0,n,r=this.callbacks.length;t<r;t++){n=this.callbacks[t];if(n.state>this.state||n.callback==null)continue;n.callback(this),n.callback=null}},ready:function(e){return this.on(4,function(){h.ready(this.resolve.bind(this,e))}.bind(this))},loaded:function(e){return this.on(4,function(){h.load(e)})},done:function(e){return this.on(4,this.resolve.bind(this,e))},resolve:function(t){e.include=this,t(this.response)}};var d=function(){};d.prototype={setCurrent:function(t){e.include=new m(null,t.route,t.namespace,null,null,t.id)},incl:function(e,t){if(this instanceof m)return this.include(e,t);var n=new m;return n.include(e,t)},js:function(e){return this.incl("js",e)},css:function(e){return this.incl("css",e)},load:function(e){return this.incl("load",e)},ajax:function(e){return this.incl("ajax",e)},embed:function(e){return this.incl("embed",e)},lazy:function(e){return this.incl("lazy",e)},cfg:function(e){switch(typeof e){case"object":for(var t in e)i[t]=e[t];break;case"string":if(arguments.length==1)return i[e];arguments.length==2&&(i[e]=arguments[1]);break;case"undefined":return i}return this},routes:function(e){if(e==null)return c.getRoutes();for(var t in e)c.register(t,e[t]);return this},promise:function(t){var n=t.split("."),r=e;while(n.length){var i=n.shift();r=r[i]||(r[i]={})}return r},register:function(e){for(var r in e)for(var i=0;i<e[r].length;i++){var s=e[r][i].id,o=e[r][i].url,u=e[r][i].namespace,a=new m;a.state=4,a.namespace=u,a.type=r,o&&(o[0]=="/"&&(o=o.substring(1)),a.location=l.uri.getDir(o));switch(r){case"load":case"lazy":var f=t.querySelector("#includejs-"+s);if(f==null){console.error('"%s" Data was not embedded into html',s);return}a.obj=f.innerHTML}(n[r]||(n[r]={}))[s]=a}}};var v=function(){var n,r,s=[],o=function(e,r){var i=t.createElement("script");i.type="application/javascript",i.src=e,i.onload=i.onerror=r,(n||(n=t.querySelector("head"))).appendChild(i)},u=function(e){var t=e.includes;if(t!=null&&t.length)for(var n=0;n<t.length;n++)if(t[n].state!=4)return;e.readystatechanged(4)},a=function(){if(s.length===0)return;if(r!=null)return;var t=r=s[0];if(t.state===1)return;t.state=1,e.include=t,e.iparams=t.route.params,o(t.url,function(e){for(var n=0,i=s.length;n<i;n++)if(s[n]===t){s.splice(n,1);break}t.state=3,u(t),r=null,a()})},f=function(){if(s.length===0)return;if(r!=null)return;var e=s[0];if(e&&e.state>2){r=e,e.state=1;try{__eval(e.source,e)}catch(t){t.url=e.url,l.reportError(t)}for(var n=0,i,o=s.length;n<o;n++){i=s[n];if(i==e){s.splice(n,1);break}}e.state=3,u(e),r=null,f()}};return{load:function(e,t){var n=!1;if(t)for(var r=0,o=s.length;r<o;r++)if(s[r]===t){s.splice(r,0,e),n=!0;break}n||s.push(e),i.eval?l.xhr(e.url,function(t,n){n||console.error("Not Loaded:",t),e.source=n,e.readystatechanged(3),f()}):a()}}}(),m=function(e,r,i,s,o,a){d.call(this),p.call(this);if(e==null)return this;var f=r&&r.path;this.route=r,this.namespace=i,this.type=e,this.xpath=s,this.url=f,f!=null&&(this.url=l.uri.resolveUrl(f,o)),a||(i?a=i:f[0]=="/"?a=f:o&&o.namespace?a=o.namespace+"/"+f:o&&o.location?a="/"+o.location.replace(/^[\/]+/,"")+f:o&&o.id?a=o.id+"/"+f:a="/"+f);if(n[e]&&n[e][a])return n[e][a];u!=null&&u[a]!=null?f=u[a]:f=this.url,this.location=l.uri.getDir(f),(n[e]||(n[e]={}))[a]=this;var c;switch(e){case"js":this.exports={},v.load(this,o);break;case"ajax":case"load":case"lazy":l.xhr(f,this.onXHRLoaded.bind(this));break;case"css":this.state=4,c=t.createElement("link"),c.href=f,c.rel="stylesheet",c.type="text/css";break;case"embed":c=t.createElement("script"),c.type="application/javascript",c.src=f,c.onload=c.onerror=this.readystatechanged.bind(this,4)}return c!=null&&(t.querySelector("head").appendChild(c),c=null),this};m.prototype=l.extend({},p,d,{include:function(e,t){return this.state=1,this.includes==null&&(this.includes=[]),c.each(e,t,function(t,n,r){var i=new m(e,n,t,r,this);this.includes.push(i),i.index=this.calcIndex(e,t),i.on(4,this.childLoaded.bind(this))}.bind(this)),this},calcIndex:function(e,t){this.response==null&&(this.response={});switch(e){case"js":case"load":case"ajax":var n=e+"Index";return this.response[n]==null&&(this.response[n]=-1),++this.response[n]}return-1},childLoaded:function(e){if(e&&e.exports)switch(e.type){case"js":case"load":case"ajax":if(e.route.alias){this.response[e.route.alias]=e.exports;break}var t=this.response[e.type]||(this.response[e.type]=[]);e.namespace!=null&&(t=l.ensureArray(t,e.namespace)),t[e.index]=e.exports}var n=this.includes;if(n&&n.length)for(var r=0;r<n.length;r++)if(n[r].state!=4)return;this.readystatechanged(4)},onXHRLoaded:function(e,t){if(t)switch(this.type){case"load":case"ajax":this.exports=t;break;case"lazy":g.create(this.xpath,t)}else console.warn("Resource cannt be loaded",this.url);this.readystatechanged(4)}});var g={create:function(t,n){var r=t.split("."),i=e,s=r[r.length-1];while(r.length>1){var o=r.shift();i=i[o]||(i[o]={})}r=null,Object.defineProperty(i,s,{get:function(){delete i[s];try{var r=__eval(n,e.include);r==null||r instanceof m||(i[s]=r)}catch(o){o.xpath=t,l.reportError(o)}finally{return n=null,t=null,i[s]}}})}};e.include=new d,e.include.helper=l,e.include.Routes=c,e.IncludeResource=m})(typeof window=="undefined"?global:window,typeof document=="undefined"?null:document);