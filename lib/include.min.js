var __eval=function(source,include){"use strict";var iparams=include&&include.route.params;try{return eval(source)}catch(error){error.url=include&&include.url,console.error(error)}};(function(global,document){"use strict";var bin={},isWeb=!!(global.location&&global.location.protocol&&/^https?:/.test(global.location.protocol)),cfg={eval:document==null},handler={},hasOwnProp={}.hasOwnProperty,XMLHttpRequest=global.XMLHttpRequest,Helper={uri:{getDir:function(e){var t=e.lastIndexOf("/");return t==-1?"":e.substring(t+1,-t)},resolveCurrent:function(){var e=document.getElementsByTagName("script");return e[e.length-1].getAttribute("src")},resolveUrl:function(e,t){cfg.path&&e[0]=="/"&&(e=cfg.path+e.substring(1));switch(e.substring(0,5)){case"file:":case"http:":return e}if(e[0]==="/"){if(isWeb===!1||cfg.lockedToFolder===!0)e=e.substring(1)}else t!=null&&t.location!=null&&(e=t.location+e);while(e.indexOf("../")>-1)e=e.replace(/[^\/]+\/\.\.\//,"");return e}},extend:function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];typeof n=="function"&&(n=n.prototype);for(var r in n)e[r]=n[r]}return e},invokeEach:function(e,t){if(e==null)return;if(e instanceof Array)for(var n=0,r,i=e.length;n<i;n++)r=e[n],typeof r=="function"&&(t!=null?r.apply(this,t):r())},doNothing:function(e){typeof e=="function"&&e()},reportError:function(e){console.error("IncludeJS Error:",e,e.message,e.url),typeof handler.onerror=="function"&&handler.onerror(e)},ensureArray:function(e,t){if(!t)return e;var n=t.split(".");while(n.length-1){var r=n.shift();e=e[r]||(e[r]={})}return e[n.shift()]=[]}},XHR=function(e,t){var n=new XMLHttpRequest,r=Date.now();n.onreadystatechange=function(){n.readyState==4&&t&&t(e,n.responseText)},n.open("GET",typeof e=="object"?e.url:e,!0),n.send()},RoutesLib=function(){var e={},t=/([^\\\/]+)\.\w+$/;return{register:function(t,n){e[t]=n instanceof Array?n:n.split(/[\{\}]/g)},resolve:function(t,n){var r=n.indexOf("?"),i=n.indexOf("::"),s,o,u,a,f,l,c;~i&&(s=n.substring(i+2),n=n.substring(0,i));if(~r){var h=n.substring(r+1).split("&");u={};for(f=0,c=h.length;f<c;f++)l=h[f].split("="),u[l[0]]=l[1];n=n.substring(0,r)}n=n.split("/"),a=e[t];if(a==null)return{path:n.join("/"),params:u,alias:s};o=a[0];for(f=1;f<a.length;f++)if(f%2===0)o+=a[f];else{var p=a[f]<<0;p>n.length-1&&(p=n.length-1),o+=n[p];if(f==a.length-2)for(p++;p<n.length;p++)o+="/"+n[p]}return{path:o,params:u,alias:s}},each:function(e,t,n,r,i){var s;if(t==null){console.error("Include Item has no Data",e,r);return}if(e=="lazy"&&i==null){for(s in t)this.each(e,t[s],n,null,s);return}if(t instanceof Array){for(var o=0;o<t.length;o++)this.each(e,t[o],n,r,i);return}if(typeof t=="object"){for(s in t)hasOwnProp.call(t,s)&&this.each(e,t[s],n,s,i);return}if(typeof t=="string"){var u=this.resolve(r,t);r&&(r+="."+t),n(r,u,i);return}console.error("Include Package is invalid",arguments)},getRoutes:function(){return e},parseAlias:function(e){var n=e.path,r=t.exec(n);return r&&r[1]}}},Routes=RoutesLib(),Events=function(e){if(e==null)return{ready:Helper.doNothing,load:Helper.doNothing};var t=[],n=null,r=Date.now();return e.onreadystatechange=function(){if(/complete|interactive/g.test(e.readyState)===!1)return;r&&console.log("DOMContentLoader",e.readyState,Date.now()-r,"ms"),Events.ready=Helper.doNothing,Helper.invokeEach(t),t=null,e.readyState=="complete"&&(Events.load=Helper.doNothing,Helper.invokeEach(n),n=null)},{ready:function(e){t.unshift(e)},load:function(e){(n||(n=[])).unshift(e)}}}(document),IncludeDeferred=function(){this.callbacks=[],this.state=0};IncludeDeferred.prototype={on:function(e,t){return e<=this.state?t(this):this.callbacks[this.state<3?"unshift":"push"]({state:e,callback:t}),this},readystatechanged:function(e){var t,n,r,i;e>this.state&&(this.state=e);if(this.state===3){var s=this.includes;if(s!=null&&s.length)for(t=0;t<s.length;t++)if(s[t].resource.state!=4)return;this.state=4}t=0,n=this.callbacks.length;if(n===0)return;this.type==="js"&&this.state===4&&(i=global.include,global.include=this);for(;t<n;t++){r=this.callbacks[t];if(r==null||r.state>this.state)continue;this.callbacks.splice(t,1),n--,t--,r.callback(this);if(this.state<4)break}i!=null&&(global.include=i)},ready:function(e){return this.on(4,function(){Events.ready(this.resolve.bind(this,e))}.bind(this))},loaded:function(e){return this.on(4,function(){Events.load(e)})},done:function(e){return this.on(4,this.resolve.bind(this,e))},resolve:function(e){var t=this.includes,n=t==null?0:t.length;if(n>0&&this.response==null){this.response={};var r,i;for(var s=0,o;s<n;s++){o=t[s],r=o.resource,i=o.route;if(!r.exports)continue;var u=r.type;switch(u){case"js":case"load":case"ajax":var a=i.alias||Routes.parseAlias(i),f=u=="js"?this.response:this.response[u]||(this.response[u]={});if(a){f[a]=r.exports;break}console.warn("Resource Alias is Not defined",r)}}}e(this.response)}};var Include=function(){function embedPlugin(source){eval(source)}function enableModules(){Object.defineProperty(global,"module",{get:function(){return global.include}}),Object.defineProperty(global,"exports",{get:function(){var e=global.include;return e.exports||(e.export={})},set:function(e){global.include.exports=e}})}var Include=function(){};return Include.prototype={setCurrent:function(e){var t=new Resource("js",{path:e.id},e.namespace,null,null,e.id);t.state!=4&&console.error("Current Resource should be loaded"),t.state=3,global.include=t},incl:function(e,t){if(this instanceof Resource)return this.include(e,t);var n=new Resource;return n.type="js",n.include(e,t)},js:function(e){return this.incl("js",e)},css:function(e){return this.incl("css",e)},load:function(e){return this.incl("load",e)},ajax:function(e){return this.incl("ajax",e)},embed:function(e){return this.incl("embed",e)},lazy:function(e){return this.incl("lazy",e)},cfg:function(e){switch(typeof e){case"object":for(var t in e)cfg[t]=e[t],t=="modules"&&e[t]===!0&&enableModules();break;case"string":if(arguments.length==1)return cfg[e];arguments.length==2&&(cfg[e]=arguments[1]);break;case"undefined":return cfg}return this},routes:function(e){if(e==null)return Routes.getRoutes();for(var t in e)Routes.register(t,e[t]);return this},promise:function(e){var t=e.split("."),n=global;while(t.length){var r=t.shift();n=n[r]||(n[r]={})}return n},register:function(e){for(var t in e)for(var n=0;n<e[t].length;n++){var r=e[t][n].id,i=e[t][n].url,s=e[t][n].namespace,o=new Resource;o.state=4,o.namespace=s,o.type=t,i&&(i[0]=="/"&&(i=i.substring(1)),o.location=Helper.uri.getDir(i));switch(t){case"load":case"lazy":var u=document.querySelector("#includejs-"+r.replace(/\W/g,""));if(u==null){console.error('"%s" Data was not embedded into html',r);return}o.exports=u.innerHTML}(bin[t]||(bin[t]={}))[r]=o}},instance:function(){return new Resource},getResource:function(e,t){var n=(e[0]=="/"?"":"/")+e;if(t!=null)return bin[t][n];for(var r in bin)if(bin[r].hasOwnProperty(n))return bin[r][n];return null},plugin:function(e,t){var n=[],r=0,i=0,s=0,o=function(e,n){i++,embedPlugin(n),i==r-1&&t&&(t(),t=null)};Routes.each("",e,function(e,t){n.push(t.path[0]=="/"?t.path.substring(1):t.path)}),r=n.length;for(;s<r;s++)XHR(n[s],o);return this}},Include}(),ScriptStack=function(){var e,t,n=[],r=function(t,n){var r=document.createElement("script");r.type="text/javascript",r.src=t,"onreadystatechange"in r?r.onreadystatechange=function(){(this.readyState=="complete"||this.readyState=="loaded")&&n()}:r.onload=r.onerror=n,(e||(e=document.getElementsByTagName("head")[0])).appendChild(r)},i=function(){function s(r){r&&r.type=="error"&&console.log("Script Loaded Error",e.url);var s=0,o=n.length;for(;s<o;s++)if(n[s]===e){n.splice(s,1);break}if(s==o){console.error("Loaded Resource not found in stack",e);return}e.readystatechanged(3),t=null,i()}if(n.length===0)return;if(t!=null)return;var e=t=n[0];if(e.state===1)return;e.state=1,global.include=e,global.iparams=e.route.params;if(e.source){__eval(e.source,e),s();return}r(e.url,s)},s=function(){if(n.length===0)return;if(t!=null)return;var e=n[0];if(e.state<2)return;t=e,e.state=1,global.include=e,__eval(e.source,e);for(var r=0,i,o=n.length;r<o;r++){i=n[r];if(i==e){n.splice(r,1);break}}e.readystatechanged(3),t=null,s()};return{load:function(e,t,r){var o=!1;if(t)for(var u=0,a=n.length;u<a;u++)if(n[u]===t){n.splice(u,0,e),o=!0;break}o||n.push(e);if(!cfg.eval||r){i();return}if(e.source){e.state=2,s();return}XHR(e,function(e,t){t||console.error("Not Loaded:",e.url),e.source=t,e.state=2,s()})},moveToParent:function(e,t){var r,i,s,o=2;for(r=0,s,i=n.length;r<i&&o;r++)s=n[r],s===e&&(n.splice(r,1),i--,r--,o--),s===t&&(n.splice(r,0,e),i++,r++,o--);t==null&&n.unshift(e)}}}(),CustomLoader=function(){function t(t){var n=t.substring(t.lastIndexOf(".")+1);if(e.hasOwnProperty(n))return e[n];var r=cfg.loader[n],i,s;if(typeof r=="object")for(var o in r){s=o,i=r[o];break}return e[n]=new Resource("js",Routes.resolve(s,i),s)}var e={};return{load:function(e,n){var r=t(e.url);r.done(function(){XHR(e,function(e,t){n(e,r.exports.process(t,e))})})},exists:function(e){if(!e.url||!cfg.loader)return!1;var t=e.url,n=t.substring(t.lastIndexOf(".")+1);return cfg.loader.hasOwnProperty(n)}}}(),LazyModule={create:function(e,t){var n=e.split("."),r=global,i=n[n.length-1];while(n.length>1){var s=n.shift();r=r[s]||(r[s]={})}n=null,Object.defineProperty(r,i,{get:function(){delete r[i];try{var n=__eval(t,global.include);n==null||n instanceof Resource||(r[i]=n)}catch(s){s.xpath=e,Helper.reportError(s)}finally{return t=null,e=null,r[i]}}})}},Resource=function(e,t,n,r,i){function s(e,t){var n=e.type,s=e.parent,u=e.url;if(i.exists(e)===!1)switch(n){case"js":case"embed":r.load(e,s,n=="embed");break;case"ajax":case"load":case"lazy":XHR(e,o);break;case"css":e.state=4;var a=document.createElement("link");a.href=u,a.rel="stylesheet",a.type="text/css",document.getElementsByTagName("head")[0].appendChild(a)}else i.load(e,o);return e}function o(e,t){if(!t){console.warn("Resource cannt be loaded",e.url),e.readystatechanged(4);return}switch(e.type){case"js":case"embed":e.source=t,r.load(e,e.parent,e.type=="embed");return;case"load":case"ajax":e.exports=t;break;case"lazy":LazyModule.create(e.xpath,t);break;case"css":var n=document.createElement("style");n.type="text/css",n.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(n)}e.readystatechanged(4)}function u(e,t){var n=e.includes;if(n&&n.length){if(e.state<3)return;for(var r=0;r<n.length;r++)if(n[r].resource.state!=4)return}e.readystatechanged(4)}var a=function(n,i,o,u,a,f){e.call(this),t.call(this);var l=i&&i.path;l!=null&&(this.url=l=Helper.uri.resolveUrl(l,a)),this.route=i,this.namespace=o,this.type=n,this.xpath=u,this.parent=a,f==null&&l&&(f=(l[0]=="/"?"":"/")+l);var c=bin[n]&&bin[n][f];return c?(c.state===0&&n=="js"&&r.moveToParent(c,a),c):l==null?(this.state=3,this):(this.location=Helper.uri.getDir(l),(bin[n]||(bin[n]={}))[f]=this,cfg.version&&(this.url+=(~this.url.indexOf("?")?"&":"?")+"v="+cfg.version),s(this))};return a.prototype=Helper.extend({},t,e,{include:function(e,t){this.state=this.state>=3?3:2,this.includes==null&&(this.includes=[]),this.childLoaded==null&&(this.childLoaded=u.bind(this,this)),this.response=null;var r=u.bind(this);return n.each(e,t,function(t,n,r){var i=new a(e,n,t,r,this);this.includes.push({resource:i,route:n}),i.on(4,this.childLoaded)}.bind(this)),this}}),a}(Include,IncludeDeferred,Routes,ScriptStack,CustomLoader);global.include=new Include,global.includeLib={Helper:Helper,Routes:RoutesLib,Resource:Resource,ScriptStack:ScriptStack,registerLoader:CustomLoader.register}})(typeof window=="undefined"?global:window,typeof document=="undefined"?null:document);