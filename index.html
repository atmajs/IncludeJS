<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <script src='lib/class.js'></script>
    <script src='lib/include.js'></script>
	<script src='dev/script/main.js'></script>
	
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Lekton:700" type='text/css' />
    <link rel="stylesheet" href="dev/style/main.css" />
    
</head>
<body>
    
<script type='text/template' id='layoutMask'>
    
    a.fork href="https://github.com/tenbits/IncludeJS" > img src="https://s3.amazonaws.com/github/ribbons/forkme_left_gray_6d6d6d.png";

    section#content {
        header{
            h3 style='font-face:Lekto, "Segoe UI",sans-serif' {
                "INCLUDE.JS - /** no comments */"
            }
            div#navi{
                span.active data-id='use'> 'Use'
                span data-id='build'> 'Build'                
            }
        }
    
        section#use.view > prism language='javascript' src='dev/script/help.usage.js';
        section#build.view.hidden > prism language='javascript' src='dev/script/help.build.js';
        
        
        div style='height:50px';
    }
    footer{
        '}'
        code > '// "Весь наш мир - велосипед."'
        div.scroller data-target='examples';
    }
    
</script>




<!-- Examples. Used for PRE tag-->

<div id='help' style='display: none;'>
    <div name='examples'>
        <div name='simple'>
            <div name='template'>
                div#panel
                    style='background:#6BA43C; color:#1E5043; font-weight:bold; padding:10px;' >
                        '#{caption}'
            </div>
            <div name='script'>
                var x = { caption: 'Ну как-то так, мир!' };
                document.querySelector('#examples .result').appendChild(mask.renderDom(template, x));
            </div>
        </div>
        <div name='list'>
            <div name='template'>
                h4 >'А это для милых дам!'
                list value='flowers'>
                        div style='width: 70; display: inline-block; margin:4px;' {
                            img src='#{url}';
                            div style='font-size:10pt; text-align:center; ' > '#{name}'
                        }    
            </div>
            <div name='script'>
                var x = {
                    flowers: [{
                        url: 'resources/flowers/Gaensebluemchen.png',
                        name: 'Ромашки'
                    }, {
                        url: 'resources/flowers/Lilie.png',
                        name: 'Лилия'
                    }, {
                        url: 'resources/flowers/Nelke.png',
                        name: 'Гвоздика'
                    }, {
                        url: 'resources/flowers/Rose.png',
                        name: 'Роза'
                    }, {
                        url: 'resources/flowers/Orchidee.png',
                        name: 'Орхидея'
                    }]
                }
                document.querySelector('#examples .result').appendChild(mask.renderDom(template, x));
            </div>
        </div>
        <div name='custom'>
            <div name='template'>
                h4 > 'Повторим?' flowers;
            </div>
            <script name='script' type='none'>
                /** создадим обработчик тэга flowers: */
                var Flowers = function() {
                       this.flowers = [{
                           url: 'resources/flowers/Gaensebluemchen.png',
                           name: 'Ромашки'
                       }, {
                           url: 'resources/flowers/Lilie.png',
                           name: 'Лилия'
                       }, {
                           url: 'resources/flowers/Nelke.png',
                           name: 'Гвоздика'
                       }, {
                           url: 'resources/flowers/Rose.png',
                           name: 'Роза'
                       }, {
                           url: 'resources/flowers/Orchidee.png',
                           name: 'Орхидея'
                       }]
                   }
                   
                   Flowers.prototype.render = function(values, container) {
                       var div = document.createElement('div'),
                           arr = this.flowers,
                           html = [];
                       for (var i = 0; i < arr.length; i++) {
                           html.push('<div style="display:inline-block; margin:4px;"><img src="');
                           html.push(arr[i].url);
                           html.push('"/><div style="text-align: center; font-size:10pt;">');
                           html.push(arr[i].name);
                           html.push('</div></div>');
                       }
                       div.innerHTML = html.join('');
                       container.appendChild(div);
                       
                   }
                   
                   mask.registerHandler('flowers', Flowers);                    
                   
                   
                   /** темперь можем рендерить нашу маску */
                   document.querySelector('#examples .result').appendChild(mask.renderDom(template));
            </script>
        </div>
        <div name='binding'>
            <div name='template'>
                div > bind value='counter';
            </div>
            <div name="script">
                /** Код тэга 'bind': */                
                var Binding = function(){
                    
                }
                Binding.prototype.render = function(values, container){
                    var value = values[this.attr.value];
                    
                    Object.defineProperty(values, this.attr.value, {
                        get: function(){
                            return value;
                        },
                        set: function(x){
                            container.innerHTML = (value = x);                            
                        }
                    })
                    container.innerHTML = value;
                    return container;
                }
                mask.registerHandler('bind', Binding);

                
                /** K.O.: Код*/
                var json = { counter: 0 },
                    dom = mask.renderDom("h3 > bind value='counter';", json);
                
                document.querySelector('#examples .result').appendChild(dom);
                
                this.interval = setInterval(function(){ json.counter++; },500);                
            </div>
        </div>
        <div name="utility">
            <div name="template">
                div > '#{L:hello} #{L:human}!'
                select#language {
                    option selected='#{:current=="en"?"selected":""}' > 'en'
                    option selected='#{:current=="de"?"selected":""}' > 'de'
                    option selected='#{:current=="ru"?"selected":""}' > 'ru'
                }
            </div>
            <div name="script">
                var dictionary = {
                    en: {
                        hello: 'Hello',
                        human: 'Human'
                    },
                    ru: {
                        hello: 'Привет',
                        human: 'Человек'
                    },
                    de: {
                        hello: 'Hallo',
                        human: 'Mensch'
                    }
                }
                var lang = 'ru';
                if (navigator.language){
                    lang = navigator.language.substring(0, navigator.language.indexOf('-')).toLowerCase();
                }
                if (lang in dictionary == false) lang = 'ru';
                    
                
                mask.registerUtility('L',function(key, values){
                    return dictionary[lang][key];
                });
                
                function render(){
                    var dom = mask.renderDom(template, {current: lang});
                    $('#examples .result').html(dom).find('select').change(function(){
                        lang = $(this).attr('value');
                        render();
                    });
                }
                render();
            </div>
        </div>
        
    </div>
    <div name='api'>
        <div name='methods'>
            <div name="renderHtml">
                <div name="description">
                    Накладываем маску на данные  - рэндерим String. <br/>
                    @params: (StringTemplate, JsonValues)
                </div>                
            </div>
            <div name="renderDom">
                <div name="description">
                    Накладываем маску на данные  - рэндерим DocumentFragment.<br/>
                    params: (StringTemplate, JsonValues)
                </div>
            </div>
            <div name="registerHandler">
                <div name="description">
                    Регистрируем кастомный тэг. <br/>
                    @params: (StringName, Function(Class)) <hr/>
                    Когда билдер встретит тэг с заданным именем, он создаст класс Function и передаст контекст билдинга в функцию
                    <code> render(CurrentTemplateValues, CurrentBuildStream) </code>
                    , где Values -  это наш переданый Json, a BuildStream - это или HTMLElement или Array в зависимости от вызваного метода (
                    <code> renderDom </code>  или 
                    <code> renderHtml </code> ) <br/> 
                    А так же, билдер присвоит классу 2 обьекта: attr и nodes - это пропарсенные аттрибуты тэга и его дети. <br/>
                    Далее у вас полная свобода действия, например:
                    <ul>
                        <li> в сличае dom: <code> stream.appendChild(myCustomHtmlWithLotOfChildren) </code> </li> 
                        <li> в сличае html: <code> stream.push(myHtmlString)</code>  (разумеется произволние количество раз) </li>
                        <li> 
                            можна изменить this.nodes или this.attr и передать билдеру досабирать вниз дерево: 
                            <code> mask.ICustomTag.prototype.render.call(this,CurrentTemplateValues, CurrentBuildStream)</code>
                        </li>
                        <li> ну и кучу других вещей..</li>                    
                    </ul>
                </div>
            </div>
            <div name='registerUtility'>
                <div name="description">
                    Регистрируем обработчик входных данных. <br/> @params: (StringName, Function)
                    <hr/>    
                    Если билдер встретит следующий синтаксис:    
                    <code> #{utility:value} </code>
                    Он вызовет функцию 'utility' и передаст в него значение value.
                    В маску вставится то, что вернет эта функция.
                </div>
            </div>
        </div>
        <div name='tags'>
            <div name='list'>
                <div name='description'>
                    list value='key' [>{] (template)
                    <hr/>
                    key - это массив из json обьектов, которые по очереди подставятся N раз в (template),
                    и таким образом построится наш список
                </div>
            </div>
            <div name="visible">
                <div name="description">
                    visible value='assertion' [>{] (template)
                    <hr/>
                    Если (assertion), только тогда рэндерится (template)
                </div>
                <div name='example'>
                    Template: visible value='day>5 && season=="summer"' > div style='background:red;';
                    
                    Script: mask.render(template, { day: 6, season: "summer" })
                    
                    Output: "&lt;div style='background:red;'>&lt;/div>
                    
                </div>
            </div>
        </div>
        
    </div>
</div>


<script id='syntax-template' type='syntax/template'>

#{key} - где key это имя ключа в json(переданных данных) (через точку можно "идти в глубину")
var json = { o : { a: 'bro' } };
mask.renderHtml("'Hi, #{o.a}'") => "Hi, bro"


#{:assertion} - пример:
var template = div.#{:value>100?"red":"green"}
mask.renderHtml(template, {value: 80}) => '<div class="red"></div>'
mask.renderHtml(template, {value: 200}) => '<div class="green"></div>'

#{utilityName:input} - (см. пример 'Трансформация данных')

Подробнее на примере:

var values = {
    id: 'ID',
    class: 'CLASS',
    name: 'X',
    info {
        title: 'TITLE',
        more : {
            description: '...'
        }
    }
}
div##{id}.#{class} name="name-#{name}" {
    h3 > '#{info.title}'
    div > '#{info.more.description}'
}
</script>



</body>
</html>














